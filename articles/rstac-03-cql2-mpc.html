<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Reading Planetary Computer Data using CQL2 filter extension • rstac</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reading Planetary Computer Data using CQL2 filter extension">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rstac</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/rstac-01-intro.html">Introduction to rstac package</a></li>
    <li><a class="dropdown-item" href="../articles/rstac-02-cql2.html">CQL2 examples</a></li>
    <li><a class="dropdown-item" href="../articles/rstac-03-cql2-mpc.html">Reading Planetary Computer Data using CQL2 filter extension</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/brazil-data-cube/rstac/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="rstac-03-cql2-mpc_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="rstac-03-cql2-mpc_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="rstac-03-cql2-mpc_files/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="rstac-03-cql2-mpc_files/leaflet-1.3.1/leaflet.js"></script><link href="rstac-03-cql2-mpc_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="rstac-03-cql2-mpc_files/proj4-2.6.2/proj4.min.js"></script><script src="rstac-03-cql2-mpc_files/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="rstac-03-cql2-mpc_files/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="rstac-03-cql2-mpc_files/leaflet-binding-2.2.2/leaflet.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Reading Planetary Computer Data using CQL2 filter extension</h1>
            
            <h4 data-toc-skip class="date">2022-12-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/brazil-data-cube/rstac/blob/vignettes/vignettes/rstac-03-cql2-mpc.Rmd" class="external-link"><code>vignettes/rstac-03-cql2-mpc.Rmd</code></a></small>
      <div class="d-none name"><code>rstac-03-cql2-mpc.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://brazil-data-cube.github.io/rstac/">rstac</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/slider" class="external-link">slider</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr.r-lib.org/" class="external-link">httr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 class="unnumbered" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This tutorial will use the open-source package <code>rstac</code> to
search data in Planetary Computer’s SpatioTemporal Asset Catalog (STAC)
service. STAC services can be accessed through STAC API endpoints, which
allow users to search datasets using various parameters such as space
and time. In addition to demonstrating the use of <code>rstac</code>,
the tutorial will explain the Common Query Language (CQL2) filter
extension to narrow the search results and find datasets that meet
specific criteria in the STAC API.</p>
<p>This tutorial is based on <a href="https://planetarycomputer.microsoft.com/docs/quickstarts/reading-stac/" class="external-link">reading
STAC API data in Python</a>.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="reading-data-from-stac-api">Reading data from STAC API<a class="anchor" aria-label="anchor" href="#reading-data-from-stac-api"></a>
</h2>
<p>To access Planetary Computer STAC API, we’ll create a
<code>rstac</code> query.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">planetary_computer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stac.html">stac</a></span><span class="op">(</span><span class="st">"https://planetarycomputer.microsoft.com/api/stac/v1"</span><span class="op">)</span></span>
<span><span class="va">planetary_computer</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">###rstac_query</span></span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">url:</span> https://planetarycomputer.microsoft.com/api/stac/v1/</span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">params:</span></span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">field(s):</span> version, base_url, endpoint, params, verb, encode</span></span></code></pre></div>
<div class="section level3">
<h3 class="unnumbered" id="listing-supported-properties-in-cql2">Listing supported properties in CQL2<a class="anchor" aria-label="anchor" href="#listing-supported-properties-in-cql2"></a>
</h3>
<p>CQL2 expressions can be constructed using properties that refer to
attributes of items. A list of all properties supported by a collection
can be obtained by accessing the
<code>/collections/&lt;collection_id&gt;/queryables</code> endpoint.
Filter expressions can use properties listed in this endpoint.</p>
<p>In this example, we will search for <a href="https://planetarycomputer.microsoft.com/dataset/landsat-c2-l2" class="external-link">Landsat
Collection 2 Level-2</a> imagery of the Microsoft main campus from
December 2020. The name of this collection in STAC service is
<code>landsat-c2-l2</code>. Here we’ll prepare a query to retrieve its
queryables and make a <code>GET</code> request to the service.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">planetary_computer</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collections.html">collections</a></span><span class="op">(</span><span class="st">"landsat-c2-l2"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/queryables.html">queryables</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/request.html">get_request</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">###Queryables</span></span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">properties</span> (27 entries(s)):</span></span>
<span><span class="co">#&gt;   - id</span></span>
<span><span class="co">#&gt;   - gsd</span></span>
<span><span class="co">#&gt;   - created</span></span>
<span><span class="co">#&gt;   - sci:doi</span></span>
<span><span class="co">#&gt;   - datetime</span></span>
<span><span class="co">#&gt;   - geometry</span></span>
<span><span class="co">#&gt;   - platform</span></span>
<span><span class="co">#&gt;   - proj:epsg</span></span>
<span><span class="co">#&gt;   - instrument</span></span>
<span><span class="co">#&gt;   - proj:shape</span></span>
<span><span class="co">#&gt;   - ... with 17 more entry(ies).</span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">field(s):</span> $id, type, title, $schema, properties</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 class="unnumbered" id="searching-with-cql2">Searching with CQL2<a class="anchor" aria-label="anchor" href="#searching-with-cql2"></a>
</h3>
<p>Now we can use <code>rstac</code> to make a search query with CQL2
filter extension to obtain the items.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cql2_helpers.html">cql2_interval</a></span><span class="op">(</span><span class="st">"2020-12-01"</span>, <span class="st">"2020-12-31"</span><span class="op">)</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">122.2751</span>, <span class="fl">47.5469</span>, <span class="op">-</span><span class="fl">121.9613</span>, <span class="fl">47.7458</span><span class="op">)</span></span>
<span><span class="va">area_of_interest</span> <span class="op">=</span> <span class="fu"><a href="../reference/cql2_helpers.html">cql2_bbox_as_geojson</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stac_items</span> <span class="op">&lt;-</span> <span class="va">planetary_computer</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ext_filter.html">ext_filter</a></span><span class="op">(</span></span>
<span>    <span class="va">collection</span> <span class="op">==</span> <span class="st">"landsat-c2-l2"</span> <span class="op">&amp;&amp;</span></span>
<span>      <span class="fu">t_intersects</span><span class="op">(</span><span class="va">datetime</span>, <span class="op">{</span><span class="op">{</span><span class="va">time_range</span><span class="op">}</span><span class="op">}</span><span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span>      <span class="fu">s_intersects</span><span class="op">(</span><span class="va">geometry</span>, <span class="op">{</span><span class="op">{</span><span class="va">area_of_interest</span><span class="op">}</span><span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/request.html">post_request</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>In that example, our filter expression used a temporal
(<code>t_intersects</code>) and a spatial (<code>s_intersects</code>)
operators. <code>t_intersects()</code> only accepts interval as it
second argument, which we created using function
<code><a href="../reference/cql2_helpers.html">cql2_interval()</a></code>. <code>s_intersects()</code> spatial
operator only accepts GeoJSON objects as its arguments. This is why we
had to convert the bounding box vector (<code>bbox</code>) into a
structure representing a GeoJSON object using the function
<code><a href="../reference/cql2_helpers.html">cql2_bbox_as_geojson()</a></code>. We embrace the arguments using
<code>{{</code> to evaluate them before make the request.</p>
<p><code>items</code> is an <code>Items</code> object containing 8 items
that matched our search criteria.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stac_items</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">###Items</span></span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">features</span> (8 item(s)):</span></span>
<span><span class="co">#&gt;   - LC08_L2SP_046027_20201229_02_T2</span></span>
<span><span class="co">#&gt;   - LE07_L2SP_047027_20201228_02_T1</span></span>
<span><span class="co">#&gt;   - LE07_L2SP_046027_20201221_02_T2</span></span>
<span><span class="co">#&gt;   - LC08_L2SP_047027_20201220_02_T2</span></span>
<span><span class="co">#&gt;   - LC08_L2SP_046027_20201213_02_T2</span></span>
<span><span class="co">#&gt;   - LE07_L2SP_047027_20201212_02_T1</span></span>
<span><span class="co">#&gt;   - LE07_L2SP_046027_20201205_02_T1</span></span>
<span><span class="co">#&gt;   - LC08_L2SP_047027_20201204_02_T1</span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">assets:</span> </span></span>
<span><span class="co">#&gt; ang, atmos_opacity, atran, blue, cdist, cloud_qa, coastal, drad, emis, emsd, green, lwir, lwir11, mtl.json, mtl.txt, mtl.xml, nir08, qa, qa_aerosol, qa_pixel, qa_radsat, red, rendered_preview, swir16, swir22, tilejson, trad, urad</span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">item's fields:</span> </span></span>
<span><span class="co">#&gt; assets, bbox, collection, geometry, id, links, properties, stac_extensions, stac_version, type</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 class="unnumbered" id="exploring-data">Exploring data<a class="anchor" aria-label="anchor" href="#exploring-data"></a>
</h3>
<p>An <code>Items</code> is a regular GeoJSON object. It is a collection
of <code>Item</code> entries that stores metadata on assets. Users can
convert a <code>Items</code> to a <code>sf</code> object containing the
properties field as columns. Here we depict the items footprint.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/items_functions.html">items_as_sf</a></span><span class="op">(</span><span class="va">stac_items</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a function to plot a map</span></span>
<span><span class="va">plot_map</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_mode.html" class="external-link">tmap_mode</a></span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_tiles.html" class="external-link">tm_basemap</a></span><span class="op">(</span><span class="va">providers</span><span class="op">[[</span><span class="st">"Stamen.Watercolor"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plot_map</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span><span class="co">#&gt; tmap mode set to interactive viewing</span></span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"createMapPane","args":["tmap401",401]},{"method":"addPolygons","args":[[[[{"lng":[-122.7254903,-120.2924778,-120.9898948,-123.3472198,-122.7254903],"lat":[48.5088438,48.0783502,46.3770494,46.8018651,48.5088438]}]],[[{"lng":[-124.5204639,-121.9393228,-122.5958254,-125.0918508,-124.5204639],"lat":[48.4424485,48.0694636,46.4966008,46.8572467,48.4424485]}]],[[{"lng":[-122.9680194,-120.3902432,-121.0455955,-123.5392639,-122.9680194],"lat":[48.4454719,48.0727855,46.499514,46.8597052,48.4454719]}]],[[{"lng":[-124.2754702,-121.8416742,-122.5397592,-124.8986192,-124.2754702],"lat":[48.5083121,48.0779677,46.3765134,46.8017604,48.5083121]}]],[[{"lng":[-122.7299597,-120.2969035,-120.9949826,-123.3519375,-122.7299597],"lat":[48.5085845,48.0784545,46.3765988,46.8018506,48.5085845]}]],[[{"lng":[-124.519352,-121.9396534,-122.5965833,-125.0919766,-124.519352],"lat":[48.445972,48.0729756,46.4998433,46.8604842,48.445972]}]],[[{"lng":[-122.9870854,-120.4094503,-121.0571193,-123.5545681,-122.9870854],"lat":[48.4479047,48.0672817,46.4943105,46.8553125,48.4479047]}]],[[{"lng":[-124.2738459,-121.8396547,-122.5378065,-124.896271,-124.2738459],"lat":[48.5083301,48.0782173,46.3767755,46.8020693,48.5083301]}]]],["X1","X2","X3","X4","X5","X6","X7","X8"],"x",{"interactive":false,"className":"","pane":"tmap401","stroke":true,"color":"#666666","weight":1,"opacity":1,"fill":true,"fillOpacity":0,"dashArray":"none","smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[[],"x",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"limits":{"lat":[46.3765134,48.5088438],"lng":[-125.0919766,-120.2924778]},"fitBounds":[46.3765134,-125.0919766,48.5088438,-120.2924778,[]]},"evals":[],"jsHooks":[]}</script><p>Some collections use the <code>eo</code> extension, which allows us
to sort items by attributes like cloud coverage. The next example
selects the item with lowest cloud_cover attribute:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cloud_cover</span> <span class="op">&lt;-</span> <span class="va">stac_items</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/items_functions.html">items_reap</a></span><span class="op">(</span>field <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"properties"</span>, <span class="st">"eo:cloud_cover"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">selected_item</span> <span class="op">&lt;-</span> <span class="va">stac_items</span><span class="op">$</span><span class="va">features</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">cloud_cover</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>We use function <code><a href="../reference/items_functions.html">items_reap()</a></code> to extract cloud cover
values from all features.</p>
<p>Each STAC item have an <code>assets</code> field which describes
files and provides link to access them.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/items_functions.html">items_assets</a></span><span class="op">(</span><span class="va">selected_item</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "qa"               "ang"              "red"              "blue"            </span></span>
<span><span class="co">#&gt;  [5] "drad"             "emis"             "emsd"             "trad"            </span></span>
<span><span class="co">#&gt;  [9] "urad"             "atran"            "cdist"            "green"           </span></span>
<span><span class="co">#&gt; [13] "nir08"            "lwir11"           "swir16"           "swir22"          </span></span>
<span><span class="co">#&gt; [17] "coastal"          "mtl.txt"          "mtl.xml"          "mtl.json"        </span></span>
<span><span class="co">#&gt; [21] "qa_pixel"         "qa_radsat"        "qa_aerosol"       "tilejson"        </span></span>
<span><span class="co">#&gt; [25] "rendered_preview"</span></span>
<span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="../reference/items_functions.html">items_assets</a></span><span class="op">(</span><span class="va">selected_item</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">key</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>asset <span class="op">=</span> <span class="va">key</span>, description <span class="op">=</span> <span class="va">selected_item</span><span class="op">$</span><span class="va">assets</span><span class="op">[[</span><span class="va">key</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">title</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 25 × 2</span></span></span>
<span><span class="co">#&gt;    asset description                                </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> qa    Surface Temperature Quality Assessment Band</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ang   Angle Coefficients File                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> red   Red Band                                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> blue  Blue Band                                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> drad  Downwelled Radiance Band                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> emis  Emissivity Band                            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> emsd  Emissivity Standard Deviation Band         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> trad  Thermal Radiance Band                      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> urad  Upwelled Radiance Band                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> atran Atmospheric Transmittance Band             </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more rows</span></span></span></code></pre></div>
<p>Here, we’ll inspect the <code>rendered_preview</code> asset. To plot
this asset, we can use the helper function <code><a href="../reference/preview_plot.html">preview_plot()</a></code>
and provide a URL to be plotted. We use the function
<code><a href="../reference/assets_functions.html">assets_url()</a></code> to get the URL. This function extracts all
available URLs in items.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_item</span><span class="op">$</span><span class="va">assets</span><span class="op">[[</span><span class="st">"rendered_preview"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">href</span></span>
<span><span class="co">#&gt; [1] "https://planetarycomputer.microsoft.com/api/data/v1/item/preview.png?collection=landsat-c2-l2&amp;item=LC08_L2SP_047027_20201204_02_T1&amp;assets=red&amp;assets=green&amp;assets=blue&amp;color_formula=gamma+RGB+2.7%2C+saturation+1.5%2C+sigmoidal+RGB+15+0.55&amp;format=png"</span></span>
<span></span>
<span><span class="va">selected_item</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/assets_functions.html">assets_url</a></span><span class="op">(</span>asset_names <span class="op">=</span> <span class="st">"rendered_preview"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/preview_plot.html">preview_plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="rstac-03-cql2-mpc_files/figure-html/asset-preview-1.png" width="480"></p>
<p>The <code>rendered_preview</code> asset is generated dynamically by
Planetary Computer API using raw data. We can access the raw data,
stored as Cloud Optimized GeoTIFFs (COG) in Azure Blob Storage, using
the other assets. These assets are in private Azure Blob Storage
containers and is necessary to sign them to have access to the data,
otherwise, you’ll get a 404 (forbidden) status code.</p>
</div>
<div class="section level3">
<h3 class="unnumbered" id="signing-items">Signing items<a class="anchor" aria-label="anchor" href="#signing-items"></a>
</h3>
<p>To sign URL in <code>rstac</code>, we can use
<code><a href="../reference/items_functions.html">items_sign()</a></code> function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_item</span> <span class="op">&lt;-</span> <span class="va">selected_item</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/items_functions.html">items_sign</a></span><span class="op">(</span>sign_fn <span class="op">=</span> <span class="fu"><a href="../reference/items_sign_planetary_computer.html">sign_planetary_computer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">selected_item</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/assets_functions.html">assets_url</a></span><span class="op">(</span>asset_names <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">255</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "https://landsateuwest.blob.core.windows.net/landsat-c2/level-2/standard/oli-tirs/2020/047/027/LC08_L2SP_047027_20201204_20210313_02_T1/LC08_L2SP_047027_20201204_20210313_02_T1_SR_B2.TIF?st=2024-07-17T19%3A33%3A24Z&amp;se=2024-07-18T20%3A18%3A24Z&amp;sp=rl&amp;sv=2024"</span></span></code></pre></div>
<p>Everything after the <code>?</code> in that URL is a <a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview" class="external-link">SAS
token</a> grants access to the data. See <a href="https://planetarycomputer.microsoft.com/docs/concepts/sas/" class="external-link uri">https://planetarycomputer.microsoft.com/docs/concepts/sas/</a>
for more on using tokens to access data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_item</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/assets_functions.html">assets_url</a></span><span class="op">(</span>asset_names <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://httr.r-lib.org/reference/HEAD.html" class="external-link">HEAD</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://httr.r-lib.org/reference/status_code.html" class="external-link">status_code</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 200</span></span></code></pre></div>
<p>The 200 status code means that we were able to access the data using
the signed URL with the SAS token included.</p>
</div>
<div class="section level3">
<h3 class="unnumbered" id="reading-files">Reading files<a class="anchor" aria-label="anchor" href="#reading-files"></a>
</h3>
<p>We can load up that single COG file using packages like <a href="https://github.com/r-spatial/stars" class="external-link">stars</a> or <a href="https://github.com/rspatial/terra" class="external-link">terra</a>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_item</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/assets_functions.html">assets_url</a></span><span class="op">(</span>asset_names <span class="op">=</span> <span class="st">"blue"</span>, append_gdalvsi <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html" class="external-link">read_stars</a></span><span class="op">(</span>RasterIO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nBufXSize <span class="op">=</span> <span class="fl">512</span>, nBufYSize <span class="op">=</span> <span class="fl">512</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rstac-03-cql2-mpc_files/figure-html/read-file-1.png" width="700"></p>
<p>We used the <code><a href="../reference/assets_functions.html">assets_url()</a></code> method with the
<code>append_gdalvsi = TRUE</code> parameter to insert
<code>/vsicurl</code> in the URL. This allows the GDAL VSI driver to
access the data using HTTP.</p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="searching-on-additional-properties">Searching on additional properties<a class="anchor" aria-label="anchor" href="#searching-on-additional-properties"></a>
</h2>
<p>In the previous step of this tutorial, we learned how to search for
items by specifying the space and time parameters. However, the
Planetary Computer’s STAC API offers even more flexibility by allowing
you to search for items based on additional properties.</p>
<p>For instance, collections like <code>sentinel-2-l2a</code> and
<code>landsat-c2-l2</code> both implement the <a href="https://github.com/stac-extensions/eo" class="external-link">eo</a> STAC extension and
include an <code>eo:cloud_cover</code> property. To filter your search
results to only return items that have a cloud coverage of less than
20%, you can use:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stac_items</span> <span class="op">&lt;-</span> <span class="va">planetary_computer</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ext_filter.html">ext_filter</a></span><span class="op">(</span></span>
<span>    <span class="va">collection</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sentinel-2-l2a"</span>, <span class="st">"landsat-c2-l2"</span><span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span>      <span class="fu">t_intersects</span><span class="op">(</span><span class="va">datetime</span>, <span class="op">{</span><span class="op">{</span><span class="va">time_range</span><span class="op">}</span><span class="op">}</span><span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span>      <span class="fu">s_intersects</span><span class="op">(</span><span class="va">geometry</span>, <span class="op">{</span><span class="op">{</span><span class="va">area_of_interest</span><span class="op">}</span><span class="op">}</span><span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span>      <span class="va">`eo:cloud_cover`</span> <span class="op">&lt;</span> <span class="fl">20</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/request.html">post_request</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Here we search for <code>sentinel-2-l2a</code> and
<code>landsat-c2-l2</code> assets. As a result, we have images from both
collections in our search results. Users can rename the assets to have a
common name in both collections.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stac_items</span> <span class="op">&lt;-</span> <span class="va">stac_items</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/assets_functions.html">assets_select</a></span><span class="op">(</span>asset_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B11"</span>, <span class="st">"swir16"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/assets_functions.html">assets_rename</a></span><span class="op">(</span>B11 <span class="op">=</span> <span class="st">"swir16"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stac_items</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/items_functions.html">items_assets</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "swir16"</span></span></code></pre></div>
<p><code><a href="../reference/assets_functions.html">assets_rename()</a></code> uses parameter mapper that is used to
rename asset names. The parameter can be either a named list or a
function that is called against each asset metadata. A last parameter
was included to force band renaming.</p>
<div class="section level3">
<h3 class="unnumbered" id="analyzing-stac-metadata">Analyzing STAC Metadata<a class="anchor" aria-label="anchor" href="#analyzing-stac-metadata"></a>
</h3>
<p><code>Item</code> objects are features of <code>Items</code> and
store information about assets.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stac_items</span> <span class="op">&lt;-</span> <span class="va">planetary_computer</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ext_filter.html">ext_filter</a></span><span class="op">(</span></span>
<span>    <span class="va">collection</span> <span class="op">==</span> <span class="st">"sentinel-2-l2a"</span> <span class="op">&amp;&amp;</span></span>
<span>      <span class="fu">t_intersects</span><span class="op">(</span><span class="va">datetime</span>, <span class="fu">interval</span><span class="op">(</span><span class="st">"2020-01-01"</span>, <span class="st">"2020-12-31"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span>      <span class="fu">s_intersects</span><span class="op">(</span><span class="va">geometry</span>, <span class="op">{</span><span class="op">{</span></span>
<span>        <span class="fu"><a href="../reference/cql2_helpers.html">cql2_bbox_as_geojson</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">124.2751</span>, <span class="fl">45.5469</span>, <span class="op">-</span><span class="fl">123.9613</span>, <span class="fl">45.7458</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span><span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/request.html">post_request</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stac_items</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/items_functions.html">items_fetch</a></span><span class="op">(</span><span class="va">stac_items</span><span class="op">)</span></span></code></pre></div>
<p>We can use the metadata to plot cloud cover of a region over time,
for example.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/items_functions.html">items_as_sf</a></span><span class="op">(</span><span class="va">stac_items</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>datetime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>`eo:cloud_cover` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">`eo:cloud_cover`</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>`eo:cloud_cover` <span class="op">=</span> <span class="fu"><a href="https://slider.r-lib.org/reference/summary-slide.html" class="external-link">slide_mean</a></span><span class="op">(</span><span class="va">`eo:cloud_cover`</span>, before <span class="op">=</span> <span class="fl">3</span>, after <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">datetime</span>, y <span class="op">=</span> <span class="va">`eo:cloud_cover`</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="rstac-03-cql2-mpc_files/figure-html/cloud-cover-ts-plot-1.png" width="700"></p>
<p><code><a href="../reference/cql2_helpers.html">cql2_bbox_as_geojson()</a></code> is a <code>rstac</code> helper
function and it must be evaluated before the request. This is why we
embraced it with <code>{{</code>. We use <code><a href="../reference/items_functions.html">items_fetch()</a></code> to
retrieve all paginated items matched in the search.</p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="working-with-stac-catalogs-and-collections">Working with STAC Catalogs and Collections<a class="anchor" aria-label="anchor" href="#working-with-stac-catalogs-and-collections"></a>
</h2>
<p>STAC organizes items in catalogs (<code>STACCatalog</code>) and
collections (<code>STACCollection</code>). These JSON documents contains
metadata of the dataset they refer to. For instance, here we look at the
<a href="https://github.com/stac-extensions/eo#band-object" class="external-link">Bands</a>
available for <a href="https://planetarycomputer.microsoft.com/dataset/landsat-c2-l2" class="external-link">Landsat
8 Collection 2 Level 2</a> data:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landsat</span> <span class="op">&lt;-</span> <span class="va">planetary_computer</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collections.html">collections</a></span><span class="op">(</span>collection_id <span class="op">=</span> <span class="st">"landsat-c2-l2"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/request.html">get_request</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="va">landsat</span><span class="op">$</span><span class="va">summaries</span><span class="op">$</span><span class="va">`eo:bands`</span>, <span class="va">as_tibble</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 22 × 5</span></span></span>
<span><span class="co">#&gt;    name   common_name description          center_wavelength full_width_half_max</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> TM_B1  blue        Visible blue (Thema…              0.49                0.07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> TM_B2  green       Visible green (Them…              0.56                0.08</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> TM_B3  red         Visible red (Themat…              0.66                0.06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> TM_B4  nir08       Near infrared (Them…              0.83                0.14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> TM_B5  swir16      Short-wave infrared…              1.65                0.2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> TM_B6  lwir        Long-wave infrared …             11.4                 2.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> TM_B7  swir22      Short-wave infrared…              2.22                0.27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ETM_B1 blue        Visible blue (Enhan…              0.48                0.07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ETM_B2 green       Visible green (Enha…              0.56                0.08</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ETM_B3 red         Visible red (Enhanc…              0.66                0.06</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more rows</span></span></span></code></pre></div>
<p>We can see what <a href="https://github.com/radiantearth/stac-spec/blob/master/item-spec/item-spec.md#asset-object" class="external-link">Assets</a>
are available on our item with:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="va">landsat</span><span class="op">$</span><span class="va">item_assets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">compact</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"title"</span>, <span class="st">"description"</span>, <span class="st">"gsd"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 25 × 3</span></span></span>
<span><span class="co">#&gt;    title                                       description                   gsd</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Surface Temperature Quality Assessment Band Collection 2 Level-2 Quali…    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Angle Coefficients File                     Collection 2 Level-1 Angle…    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Red Band                                    <span style="color: #BB0000;">NA</span>                             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Blue Band                                   <span style="color: #BB0000;">NA</span>                             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Downwelled Radiance Band                    Collection 2 Level-2 Downw…    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Emissivity Band                             Collection 2 Level-2 Emiss…    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Emissivity Standard Deviation Band          Collection 2 Level-2 Emiss…    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Surface Temperature Band                    Collection 2 Level-2 Therm…    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Thermal Radiance Band                       Collection 2 Level-2 Therm…    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Upwelled Radiance Band                      Collection 2 Level-2 Upwel…    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more rows</span></span></span></code></pre></div>
<p>Some collections, like <a href="https://planetarycomputer.microsoft.com/dataset/daymet-daily-na" class="external-link">Daymet</a>
include collection-level assets. You can use the <code>assets</code>
property to access those assets.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">daymet</span> <span class="op">&lt;-</span> <span class="va">planetary_computer</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collections.html">collections</a></span><span class="op">(</span>collection_id <span class="op">=</span> <span class="st">"daymet-daily-na"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/request.html">get_request</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">daymet</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">###Collection</span></span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">id:</span> daymet-daily-na</span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">title:</span> Daymet Daily North America</span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">description:</span> </span></span>
<span><span class="co">#&gt; Gridded estimates of daily weather parameters. [Daymet](https://daymet.ornl.gov) Version 4 variables include the following parameters: minimum temperature, maximum temperature, precipitation, shortwave radiation, vapor pressure, snow water equivalent, and day length.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [Daymet](https://daymet.ornl.gov/) provides measurements of near-surface meteorological conditions; the main purpose is to provide data estimates where no instrumentation exists. The dataset covers the period from January 1, 1980 to the present. Each year is processed individually at the close of a calendar year. Data are in a Lambert conformal conic projection for North America and are distributed in Zarr and NetCDF formats, compliant with the [Climate and Forecast (CF) metadata conventions (version 1.6)](http://cfconventions.org/).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use the DOI at [https://doi.org/10.3334/ORNLDAAC/1840](https://doi.org/10.3334/ORNLDAAC/1840) to cite your usage of the data.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; This dataset provides coverage for Hawaii; North America and Puerto Rico are provided in [separate datasets](https://planetarycomputer.microsoft.com/dataset/group/daymet#daily).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - <span style="font-weight: bold;">field(s):</span> </span></span>
<span><span class="co">#&gt; id, type, links, title, assets, extent, license, sci:doi, keywords, providers, description, sci:citation, stac_version, msft:group_id, cube:variables, msft:container, cube:dimensions, msft:group_keys, stac_extensions, msft:storage_account, msft:short_description, msft:region</span></span></code></pre></div>
<p>Just like assets on items, these assets include links to data in
Azure Blob Storage.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/items_functions.html">items_assets</a></span><span class="op">(</span><span class="va">daymet</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "thumbnail"  "zarr-abfs"  "zarr-https"</span></span>
<span></span>
<span><span class="va">daymet</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/assets_functions.html">assets_select</a></span><span class="op">(</span>asset_names <span class="op">=</span> <span class="st">"zarr-abfs"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/assets_functions.html">assets_url</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "abfs://daymet-zarr/daily/na.zarr"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="learn-more">Learn more<a class="anchor" aria-label="anchor" href="#learn-more"></a>
</h2>
<p>For more about the Planetary Computer’s STAC API, see <a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview" class="external-link">Using
tokens for data access</a> and the <a href="https://planetarycomputer.microsoft.com/docs/reference/stac/" class="external-link">STAC
API reference</a>. For more about CQL2 in <code>rstac</code>, type the
command <code><a href="../reference/ext_filter.html">?ext_filter</a></code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rolf Simoes, Felipe Carvalho, Brazil Data Cube Team.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
