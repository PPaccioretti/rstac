<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rstac">
<title>CQL2 examples • rstac</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="CQL2 examples">
<meta property="og:description" content="rstac">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rstac</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/cql2-example.html">CQL2 examples</a>
    <a class="dropdown-item" href="../articles/cql2-mpc-examples.html">Reading Planetary Computer Data using CQL2 filter extension</a>
    <a class="dropdown-item" href="../articles/rstac-intro.html">Introduction to rstac package</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/brazil-data-cube/rstac/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>CQL2 examples</h1>
                        <h4 data-toc-skip class="author">Rolf Simoes,
Felipe Carvalho, and Gilberto Camara</h4>
            
            <h4 data-toc-skip class="date">2022-12-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/brazil-data-cube/rstac/blob/HEAD/vignettes/cql2-example.Rmd" class="external-link"><code>vignettes/cql2-example.Rmd</code></a></small>
      <div class="d-none name"><code>cql2-example.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 class="unnumbered" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>CQL2 is an OGC standard that enables complex filter expressions on
OAFeat3 or STAC web services. CQL2 standard states that expressions can
be represented in JSON or TEXT formats. Our implementation intends to
convert native R expressions into CQL2 valid expressions without needing
cumbersome nested lists or dictionaries. Also, we can make CQL2 filter
requisition in JSON or TEXT formats with the same filter
representation.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="translating-r-expressions-to-cql2-syntax">Translating R expressions to CQL2 syntax<a class="anchor" aria-label="anchor" href="#translating-r-expressions-to-cql2-syntax"></a>
</h2>
<p>To explain the difference between the TEXT and JSON CQL2
representation, let’s start with a simple example. In the following
code, we have a valid CQL2 expression (in TEXT format) that refers to
two properties, <code>vehicle_height</code> and
<code>bridge_clearance</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>vehicle_height &gt; (bridge_clearance - 1))</span></code></pre></div>
<p>This filter expression can be passed in the HTTP GET verb implemented
by the service to retrieve only those features that satisfy the
condition. The same expression can be represented in JSON format, which
is more suitable for HTTP POST requests:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  "op": "&gt;",</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  "args": [</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    {"property":"vehicle_height"},</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>      "op": "-",</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>      "args": [</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        {"property":"bridge_clearance"},</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        1</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Note how properties <code>vehicle_height</code> and
<code>bridge_clearance</code> are represented in this format. They are
elements of an object containing a <code>property</code> member. Also,
they go as arguments of operators (in this case,<code>&gt;</code> and
<code>-</code> operators).</p>
<p>In the R language, the JSON above could be represented by nested
lists, which would be somewhat cumbersome to write. To produce valid
CQL2 filter expressions, we use the R abstract syntax tree (AST) from R
expressions that can be converted to TEXT or JSON formats. Let us see
the same previous example written in R CQL2:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://brazil-data-cube.github.io/rstac" class="external-link">rstac</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="va">vehicle_height</span> <span class="op">&gt;</span> <span class="op">(</span><span class="va">bridge_clearance</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># TEXT format</span></span>
<span><span class="co">#&gt; vehicle_height &gt; bridge_clearance - 1</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="va">vehicle_height</span> <span class="op">&gt;</span> <span class="op">(</span><span class="va">bridge_clearance</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># JSON format</span></span>
<span><span class="co">#&gt; {"op":"&gt;","args":[{"property":"vehicle_height"},{"op":"-","args":[{"property":"bridge_clearance"},1]}]}</span></span></code></pre></div>
<p>In both cases, the same CQL2 object representation is built from the
expression using AST of R expression evaluation. Then, the object is
converted into TEXT or JSON format.</p>
<p>CQL2 filters in TEXT format are sometimes represented the same way as
in the R expression. However, this should only sometimes be the case, as
we can see in some examples provided below.</p>
<div class="section level3">
<h3 class="unnumbered" id="data-types-and-literal-values">Data types and literal values<a class="anchor" aria-label="anchor" href="#data-types-and-literal-values"></a>
</h3>
<p>A literal value is any part of a CQL2 filter expression used the same
as specified in the expression.</p>
<p>The scalar data types are: <code>character string</code>,
<code>number</code>, <code>boolean</code>, <code>timestamp</code>, and
<code>date</code>.</p>
<p><strong>character string</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="st">"Via dell'Avvento"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'Via dell''Avvento'</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="st">"Via dell'Avvento"</span><span class="op">)</span></span>
<span><span class="co">#&gt; "Via dell'Avvento"</span></span></code></pre></div>
<p><strong>number</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="fl">3.1415</span><span class="op">)</span></span>
<span><span class="co">#&gt; 3.1415</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; -100</span></span></code></pre></div>
<p><strong>boolean</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; true</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; false</span></span></code></pre></div>
<p><strong>timestamp</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/savehistory.html" class="external-link">timestamp</a></span><span class="op">(</span><span class="st">"1969-07-20T20:17:40Z"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; TIMESTAMP('1969-07-20T20:17:40Z')</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/savehistory.html" class="external-link">timestamp</a></span><span class="op">(</span><span class="st">"1969-07-20T20:17:40Z"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"timestamp":"1969-07-20T20:17:40Z"}</span></span></code></pre></div>
<p><strong>date</strong></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/date.html" class="external-link">date</a></span><span class="op">(</span><span class="st">"1969-07-20"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; DATE('1969-07-20')</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/date.html" class="external-link">date</a></span><span class="op">(</span><span class="st">"1969-07-20"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"date":"1969-07-20"}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 class="unnumbered" id="property-references">Property references<a class="anchor" aria-label="anchor" href="#property-references"></a>
</h3>
<p>The property of an item can be evaluated in the CQL2 filter
expression by its name.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="va">windSpeed</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; windSpeed &gt; 1</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="va">windSpeed</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"op":"&gt;","args":[{"property":"windSpeed"},1]}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 class="unnumbered" id="standard-comparison-predicates">Standard comparison predicates<a class="anchor" aria-label="anchor" href="#standard-comparison-predicates"></a>
</h3>
<p>A comparison predicate evaluates if two scalar expressions satisfy
the specified comparison operator.</p>
<p>The standard comparison operators are: <code>=</code>,
<code>!=</code>, <code>&lt;</code>, <code>&gt;</code>,
<code>&lt;=</code>, <code>&gt;=</code>, and <code>IS NULL</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="va">city</span> <span class="op">==</span> <span class="st">"Crato"</span><span class="op">)</span></span>
<span><span class="co">#&gt; city = 'Crato'</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="va">city</span> <span class="op">==</span> <span class="st">"Jacareí"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"op":"=","args":[{"property":"city"},"Jacareí"]}</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="fu">avg</span><span class="op">(</span><span class="va">windSpeed</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; avg(windSpeed) &lt; 4</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="fu">avg</span><span class="op">(</span><span class="va">windSpeed</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"op":"&lt;","args":[{"function":{"name":"avg","args":[{"property":"windSpeed"}]}},4]}</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="va">balance</span> <span class="op">-</span> <span class="fl">150.0</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; balance - 150 &gt; 0</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="va">balance</span> <span class="op">-</span> <span class="fl">150.0</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"op":"&gt;","args":[{"op":"-","args":[{"property":"balance"},150]},0]}</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="va">updated</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/date.html" class="external-link">date</a></span><span class="op">(</span><span class="st">'1970-01-01'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; updated &gt;= DATE('1970-01-01')</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="va">updated</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/date.html" class="external-link">date</a></span><span class="op">(</span><span class="st">'1970-01-01'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"op":"&gt;=","args":[{"property":"updated"},{"date":"1970-01-01"}]}</span></span></code></pre></div>
<p><strong><code>IS NULL</code> operator</strong></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="op">!</span><span class="fu">is_null</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; geometry IS NOT NULL</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="op">!</span><span class="fu">is_null</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"op":"not","args":[{"op":"isNull","args":[{"property":"geometry"}]}]}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 class="unnumbered" id="advanced-comparison-operators">Advanced comparison operators<a class="anchor" aria-label="anchor" href="#advanced-comparison-operators"></a>
</h3>
<p>A comparison predicate evaluates if two scalar expressions satisfy
the specified comparison operator.</p>
<p>Advanced comparison operators are: <code>LIKE</code>,
<code>BETWEEN</code>, and <code>IN</code>.</p>
<p><strong><code>LIKE</code> operator</strong></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="va">name</span> <span class="op">%like%</span> <span class="st">"Smith%"</span><span class="op">)</span></span>
<span><span class="co">#&gt; name LIKE 'Smith%'</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="va">name</span> <span class="op">%like%</span> <span class="st">"Smith%"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"op":"like","args":[{"property":"name"},"Smith%"]}</span></span></code></pre></div>
<p><strong><code>BETWEEN</code> operator</strong></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">depth</span>, <span class="fl">100.0</span>, <span class="fl">150.0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; depth BETWEEN 100 AND 150</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">depth</span>, <span class="fl">100.0</span>, <span class="fl">150.0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"op":"between","args":[{"property":"depth"},100,150]}</span></span></code></pre></div>
<p><strong><code>IN</code> operator</strong></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="va">cityName</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'Toronto'</span>, <span class="st">'Frankfurt'</span>, <span class="st">'Tokyo'</span>, <span class="st">'New York'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; cityName IN ('Toronto','Frankfurt','Tokyo','New York')</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="va">cityName</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'Toronto'</span>, <span class="st">'Frankfurt'</span>, <span class="st">'Tokyo'</span>, <span class="st">'New York'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"op":"in","args":[{"property":"cityName"},["Toronto","Frankfurt","Tokyo","New York"]]}</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="op">!</span><span class="va">category</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; category NOT IN (1,2,3,4)</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="op">!</span><span class="va">category</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"op":"not","args":[{"op":"in","args":[{"property":"category"},[1,2,3,4]]}]}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 class="unnumbered" id="spatial-operators">Spatial operators<a class="anchor" aria-label="anchor" href="#spatial-operators"></a>
</h3>
<p>A spatial predicate evaluates if two spatial expressions satisfy the
specified spatial operator.</p>
<p>The supported spatial operators are: <code>S_INTERSECTS</code>,
<code>S_EQUALS</code>, <code>S_DISJOINT</code>, <code>S_TOUCHES</code>,
<code>S_WITHIN</code>, <code>S_OVERLAPS</code>, <code>S_CROSSES</code>,
and <code>S_CONTAINS</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"Polygon"</span>,</span>
<span>  coordinates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="fu">s_intersects</span><span class="op">(</span><span class="va">geometry</span>, <span class="op">{</span><span class="op">{</span><span class="va">poly</span><span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; S_INTERSECTS(geometry,POLYGON((0 0,0 1,0 1)))</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="fu">s_intersects</span><span class="op">(</span><span class="va">geometry</span>, <span class="op">{</span><span class="op">{</span><span class="va">poly</span><span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"op":"s_intersects","args":[{"property":"geometry"},{"type":"Polygon","coordinates":[[[0,0],[0,1],[0,1]]]}]}</span></span></code></pre></div>
<blockquote>
<p>Note: We provide an escape to evaluate user variables using
<code>{{</code> or <code>!!</code>. Both symbols are largely used in the
R Data Science community.</p>
</blockquote>
</div>
<div class="section level3">
<h3 class="unnumbered" id="temporal-operators">Temporal operators<a class="anchor" aria-label="anchor" href="#temporal-operators"></a>
</h3>
<p>A temporal predicate evaluates if two temporal expressions satisfy
the specified temporal operator.</p>
<p>The supported temporal operators are: <code>T_AFTER</code>,
<code>T_BEFORE</code>, <code>T_CONTAINS</code>, <code>T_DISJOINT</code>,
<code>T_DURING</code>, <code>T_EQUALS</code>, <code>T_FINISHEDBY</code>,
<code>T_FINISHES</code>, <code>T_INTERSECTS</code>,
<code>T_MEETS</code>, <code>T_METBY</code>, <code>T_OVERLAPPEDBY</code>,
<code>T_OVERLAPS</code>, <code>T_STARTEDBY</code>, and
<code>T_STARTS</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="fu">t_intersects</span><span class="op">(</span><span class="va">event_date</span>, <span class="fu">interval</span><span class="op">(</span><span class="st">"1969-07-16T05:32:00Z"</span>, <span class="st">"1969-07-24T16:50:35Z"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; T_INTERSECTS(event_date,INTERVAL('1969-07-16T05:32:00Z','1969-07-24T16:50:35Z'))</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="fu">t_intersects</span><span class="op">(</span><span class="va">event_date</span>, <span class="fu">interval</span><span class="op">(</span><span class="st">"1969-07-16T05:32:00Z"</span>, <span class="st">"1969-07-24T16:50:35Z"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"op":"t_intersects","args":[{"property":"event_date"},{"interval":["1969-07-16T05:32:00Z","1969-07-24T16:50:35Z"]}]}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 class="unnumbered" id="support-for-functions-in-cql2">Support for functions in CQL2<a class="anchor" aria-label="anchor" href="#support-for-functions-in-cql2"></a>
</h3>
<p>Functions allow implementations to extend the language.</p>
<p><strong>Example of a function that returns a geometry
value.</strong></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ext_filter.html">cql2_text</a></span><span class="op">(</span><span class="fu">s_within</span><span class="op">(</span><span class="va">road</span>, <span class="fu">Buffer</span><span class="op">(</span><span class="va">geometry</span>, <span class="fl">10</span>, <span class="st">"m"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; S_WITHIN(road,Buffer(geometry,10,'m'))</span></span>
<span><span class="fu"><a href="../reference/ext_filter.html">cql2_json</a></span><span class="op">(</span><span class="fu">s_within</span><span class="op">(</span><span class="va">road</span>, <span class="fu">Buffer</span><span class="op">(</span><span class="va">geometry</span>, <span class="fl">10</span>, <span class="st">"m"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"op":"s_within","args":[{"property":"road"},{"function":{"name":"Buffer","args":[{"property":"geometry"},10,"m"]}}]}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>In conclusion, this tutorial has demonstrated using the
<code>rstac</code> package to build CQL2 expressions, making it easier
for R users to write syntactically correct filter criteria for STAC
services. This functionality can be an alternative for users to
construct CQL2 expressions easily and efficiently. For more about CQL2
in <code>rstac</code>, type the command <code><a href="../reference/ext_filter.html">?ext_filter</a></code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Rolf Simoes, Felipe Carvalho, Brazil Data Cube Team.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
